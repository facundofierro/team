<?xml version="1.0"?>
<clickhouse>
    <!-- Single-node ClickHouse configuration for PostHog -->
    <!-- Minimal cluster definitions required for PostHog migrations -->

    <remote_servers>
        <!-- Single shard/replica pointing to localhost -->
        <posthog>
            <shard>
                <replica>
                    <host>clickhouse</host>
                    <port>9000</port>
                </replica>
            </shard>
        </posthog>
        <!-- Required for PostHog migrations -->
        <posthog_migrations>
            <shard>
                <replica>
                    <host>clickhouse</host>
                    <port>9000</port>
                </replica>
            </shard>
        </posthog_migrations>
    </remote_servers>

    <!-- Disable ZooKeeper for single-node setup -->
    <zookeeper>
        <!-- Empty zookeeper config for single-node -->
    </zookeeper>

    <!-- Force non-replicated tables for single-node setup -->
    <profiles>
        <default>
            <max_memory_usage>10000000000</max_memory_usage>
            <use_uncompressed_cache>0</use_uncompressed_cache>
            <load_balancing>random</load_balancing>
            <insert_deduplicate>0</insert_deduplicate>
            <replicated_deduplication_window>0</replicated_deduplication_window>
            <replicated_deduplication_window_seconds>0</replicated_deduplication_window_seconds>
        </default>
    </profiles>

    <!-- Macros for compatibility with PostHog migrations -->
    <macros>
        <shard>01</shard>
        <replica>01</replica>
    </macros>

</clickhouse>
